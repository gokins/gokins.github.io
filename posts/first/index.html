<!DOCTYPE html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Gavin" />
	
	
	
	<title>构建 Go 应用的一个示例 ｜ 思°</title>
	
    
    
    <meta name="description" content="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam nec interdum metus. Aenean rutrum ligula sodales ex auctor, sed tempus dui mollis. Curabitur ipsum dui, aliquet nec commodo at, tristique eget ante." />
    

    
    
    <meta name="keywords" content="思考, 技术, 编程, 架构, 管理, 商业" />
    

	
    
    <link rel="shortcut icon" href="https://blogcool.gitkin.com/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://blogcool.gitkin.com/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://blogcool.gitkin.com/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://blogcool.gitkin.com/css/highlight.css" />
    
    
</head>


<body>
<div class="main animate__animated animate__fadeInDown">
    <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">首页</a>
            </li>
            
            <li>
                <a href="/posts/">文章</a>
            </li>
            
            <li>
                <a href="/tags/">标签</a>
            </li>
            
            <li>
                <a href="/about/">关于</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
    <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="/">
                    <span>思°</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">思危 , 思变 , 思退</p>
            <div class="my_socials">
                
                
                <a href="https://www.yuque.com/gitkin/notes/vt0si0" title="cloud" target="_blank"><i class="ri-cloud-fill"></i></a>
                
                
                
                <a href="https://github.com/gokins" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://weibo.com/aiwanfulishe" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>

    <div class="content">
        <div class="post_page">
            <div class="post animate__animated animate__fadeInDown">
                <div class="post_title post_detail_title">
                    <h2><a href='/posts/first/'>构建 Go 应用的一个示例</a></h2>
                    <span class="date">2019.01.25</span>
                </div>
                <div class="post_content markdown"><p>使用多阶段构建
多阶段构建可以有效减小镜像体积，特别是对于需编译语言而言，一个应用的构建过程往往如下</p>
<p>安装编译工具
安装第三方库依赖
编译构建应用</p>
<p>而在前两步会有大量的镜像体积冗余，使用多阶段构建可以避免这一问题
这是构建 Go 应用的一个示例
FROM golang:1.11-alpine AS build</p>
<h1 id="install-tools-required-for-project">Install tools required for project</h1>
<h1 id="run-docker-build---no-cache--to-update-dependencies">Run <code>docker build --no-cache .</code> to update dependencies</h1>
<p>RUN apk add &ndash;no-cache git
RUN go get github.com/golang/dep/cmd/dep</p>
<h1 id="list-project-dependencies-with-gopkgtoml-and-gopkglock">List project dependencies with Gopkg.toml and Gopkg.lock</h1>
<h1 id="these-layers-are-only-re-built-when-gopkg-files-are-updated">These layers are only re-built when Gopkg files are updated</h1>
<p>COPY Gopkg.lock Gopkg.toml /go/src/project/
WORKDIR /go/src/project/</p>
<h1 id="install-library-dependencies">Install library dependencies</h1>
<p>RUN dep ensure -vendor-only</p>
<h1 id="copy-the-entire-project-and-build-it">Copy the entire project and build it</h1>
<h1 id="this-layer-is-rebuilt-when-a-file-changes-in-the-project-directory">This layer is rebuilt when a file changes in the project directory</h1>
<p>COPY . /go/src/project/
RUN go build -o /bin/project</p>
<h1 id="this-results-in-a-single-layer-image">This results in a single layer image</h1>
<p>FROM scratch
COPY &ndash;from=build /bin/project /bin/project
ENTRYPOINT [&quot;/bin/project&rdquo;]
CMD [&quot;&ndash;help&rdquo;]
复制代码这是构建前端应用的一个示例，可以参考 如何使用 docker 高效部署前端应用
FROM node:10-alpine as builder</p>
<p>ENV PROJECT_ENV production
ENV NODE_ENV production</p>
<h1 id="http-server-不变动也可以利用缓存">http-server 不变动也可以利用缓存</h1>
<p>WORKDIR /code</p>
<p>ADD package.json /code
RUN npm install &ndash;production</p>
<p>ADD . /code
RUN npm run build</p>
<h1 id="选择更小体积的基础镜像">选择更小体积的基础镜像</h1>
<p>FROM nginx:10-alpine
COPY &ndash;from=builder /code/public /usr/share/nginx/html
复制代码避免安装不必要的包
减小体积，减少构建时间。如前端应用使用 npm install &ndash;production 只装生产环境所依赖的包。
一个容器只做一件事
如一个web应用将会包含三个部分，web 服务，数据库与缓存。把他们解耦到多个容器中，方便横向扩展。如果你需要网络通信，则可以将他们至于一个网络下。</p>
</div>
                <div class="post_footer">
                    
                </div>
            </div>

            
            <div class="pagination">
                <div class="pagination__buttons">
                    
                    <span class="button previous">
        <a href="https://u0.pm/posts/hello/">
          <span class="button__icon">«</span>
          <span class="button__text">Hello Friend</span>
        </a>
      </span>
                    
                    
                    <span class="button next">
        <a href="https://u0.pm/posts/post1/">
          <span class="button__text">构建 Go 应用的一个示例11111</span>
          <span class="button__icon">»</span>
        </a>
      </span>
                    
                </div>
            </div>
            
            
            
            
            
        </div>
    </div>
</div>
<a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
<footer class="footer">
    <div class="footer_slogan">
        <span>“ 路漫漫其修远兮，吾将上下而求索 ”</span>
    </div>
    <div class="powered_by">
        Powered By Hugo.
    </div>
</footer>
<script src="https://cdn.jsdelivr.net/gh/gokins/china-flag-icon/src/i-love-china.js"></script>

<script src="https://blogcool.gitkin.com/js/jquery-3.5.1.min.js"></script>
<link href="https://blogcool.gitkin.com/css/fancybox.min.css" rel="stylesheet">
<script src="https://blogcool.gitkin.com/js/fancybox.min.js"></script>
<script src="https://blogcool.gitkin.com/js/zozo.js"></script>





</body>

</html>
